@using pin.Infrastructure
@if (visible)
{
    <div @onclick="HideModal" class="modal-container">
        <div @onclick="CursorNext" @onmousewheel="e=> Count(e)" @onclick:stopPropagation="true" style="transform:scale(@Scale)" class="pin-modal">
            <img src="data:image/png;base64, @source[cursor].src64" />
            <div class="modal-bottom"></div>
        </div>
    </div>
}


@code {
    private bool visible;   
    public List<PinElement> source { get; set; }
    private int cursor { get;  set; }
    private double Scale = 1;
    private double ScaleSpeed = 0.001;

    private void HideModal()
    {
        visible = false;
    }

    private void CursorNext()
    {
        cursor++;
        if (cursor < 0 || cursor >= source.Count)
            cursor = 0;
    }

    public void ShowModal(List<PinElement> source, int index)
    {
        Scale = 1;
        this.source = source;
        cursor = index;
        visible = true;
        StateHasChanged();
    }

    private void Count(WheelEventArgs e)
    {
        var newScale = Scale + e.DeltaY * ScaleSpeed;
        if (newScale > 0.01)
            Scale = newScale;
    }
}