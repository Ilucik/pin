@page "/"
@using Microsoft.Extensions.Configuration
@using pin.Infrastructure
@inject IConfiguration config
@inject IWritableOptions<UserOptions> writableConfig
@if(homeDirecory is null)
{
    <SelectHomeDirectory OnClickCallback="Load" />
}
@if (directories is not null)
{
    <Images homeDirecory="@homeDirecory" directories="@directories"/>
}

@code {
    private string homeDirecory;
    private IEnumerable<String> directories;

    protected override async Task OnInitializedAsync()
    {
        homeDirecory = config.GetValue<string>("UserOptions:HomeDirectory");
        // homeDirecory = @"C:/Users/super/Downloads/Новая папка";
        if(homeDirecory is not null)
            directories = LoadDirectories();

        await base.OnInitializedAsync();
    }


    private IEnumerable<String> LoadDirectories()
    {
        return (new DirectoryInfo(homeDirecory))
        .GetDirectories()
        .Select(e => e.Name);
    }

    private void Load(string path)
    {
        homeDirecory = path;
        writableConfig.Update(e => e.HomeDirectory = path);
        if (homeDirecory is not null)
            directories = LoadDirectories();
    }
}
